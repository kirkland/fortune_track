= semantic_form_for @transaction do |f|
  %p= f.input :description, as: :string
  %p= f.input :date, as: :string
  = render partial: 'line_item', collection: @line_items || @transaction.line_items
  %a#add_line_item{href: '#', onclick: "addLineItem()"} Add Line Item
  %p= f.submit

= render 'line_item', line_item_div_id: 'line_item_fields', style: 'display: none', line_item: LineItem.new

- content_for :js do
  :plain
    function addLineItem() {
      var newLineItem = $('#line_item_fields').clone().attr('id', '');
      newLineItem.insertBefore($('#add_line_item'));
      newLineItem.show();
    }

    function deleteLineItem(target) {
      var fields = $(target).closest('div');
      if ( fields.find('.line_item_id').val() === '' ) {
        // New record.
        console.log("new record");
        fields.remove();
      } else {
        fields.find('.deleted').val(true);
        fields.hide();
      }
    }
